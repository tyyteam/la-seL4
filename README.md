# èµ›é¢˜

å¼€æºæ“ä½œç³»ç»Ÿçš„LoongArchç§»æ¤â€”seL4å¾®å†…æ ¸ï¼š[proj97-la-seL4](https://github.com/oscomp/proj97-la-seL4)ã€‚

æ¬¢è¿å……æ»¡çƒ­æƒ…çš„ä½ ï¼Œå…³æ³¨ğŸ’–ğŸ’–ğŸ’–**LoongArchå›½äº§æŒ‡ä»¤é›†**å’Œ**seL4å¼€æºé¡¹ç›®**ğŸ’–ğŸ’–ğŸ’–

å¦‚æœä½ è§‰å¾—æœ¬å›¢é˜Ÿçš„ç§»æ¤å·¥ä½œæœ‰å‚è€ƒä»·å€¼ğŸ˜Šï¼Œè¯·ä¸è¦åæƒœä½ çš„â­

# æ–‡æ¡£å’Œæ¼”ç¤º

* è¯„å®¡ä¸å±•ç¤ºæ–‡æ¡£

  * 2022.05.30ï¼Œåˆèµ›**é¡¹ç›®è°ƒç ”ï¼Œè®¾è®¡å’Œå±•ç¤º**æ–‡æ¡£ï¼š
  * 2022.05.15ï¼Œä¸­æœŸæ£€æŸ¥æ–‡æ¡£ï¼š[ä¸­æœŸè®¾è®¡å’Œå±•ç¤ºæ–‡æ¡£](./docs/README.ä¸­æœŸæ£€æŸ¥æ–‡æ¡£.md)

  * 2022.05.15ï¼Œä¸­æœŸæ¼”ç¤ºè§†é¢‘ï¼š[æ¼”ç¤ºè§†é¢‘åŠæ–‡å­—è¯´æ˜](https://pan.baidu.com/s/1c8KKPdG0Ri_AbR2taWWPSw?pwd=2qdg)

* æŠ€æœ¯æ–‡æ¡£

  * é¡¹ç›®æ„å»ºã€ç¼–è¯‘å’Œè°ƒè¯•æ–¹æ³•ï¼š
  * å¼€å‘è¿‡ç¨‹ç§¯ç´¯çš„æŠ€æœ¯æ–‡æ¡£ï¼š



# ç›®æ ‡å’Œè¿›å±•





# é¡¹ç›®ä»“åº“å’Œé•œåƒ

åœ¨[seL4å¾®å†…æ ¸å®˜æ–¹ä»“åº“](https://github.com/seL4)é‡Œï¼ŒåŒ…å«[å¾®å†…æ ¸ä»“åº“](https://github.com/seL4/seL4)ã€[sel4testæµ‹è¯•ä»“åº“](https://github.com/seL4/sel4test)ç­‰ä¸ªä»“åº“ã€‚ä¸ºå®ç°seL4ç§»æ¤å’ŒåŸºç¡€æµ‹è¯•ï¼Œæˆ‘ä»¬forkäº†å…¶ä¸­7ä¸ªå®˜æ–¹ä»“åº“ï¼Œå¹¶åœ¨gitlabå»ºç«‹é•œåƒï¼Œè¿™7ä¸ªä»“åº“çš„åŠŸèƒ½å’Œé“¾æ¥å¦‚ä¸‹ã€‚

|     ä»“åº“å     |                           ä»“åº“æè¿°                           |                       gitlabåœ°å€(dev)                        |                       githubåœ°å€(dev)                        |
| :------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|    la-seL4     |                        seL4å¾®å†…æ ¸ä»£ç                         | [å½“å‰ä»“åº“](https://gitlab.eduxiji.net/qtliu/project788067-109730) |  [la-seL4-dev](https://github.com/tyyteam/la-seL4/tree/dev)  |
|  la-sel4test   |                 seL4æµ‹è¯•ä»£ç ï¼ˆç”¨æˆ·ç©ºé—´ç¨‹åºï¼‰                 | [la-sel4test-dev](https://gitlab.eduxiji.net/qtliu/la-sel4test/-/tree/dev) | [la-sel4test-dev](https://github.com/tyyteam/la-sel4test/tree/dev) |
| la-seL4_tools  |          æ„å»ºseL4é¡¹ç›®çš„å·¥å…·ï¼ŒåŒ…å«cmakeï¼Œelfloaderç­‰          | [la-seL4_tools-dev](https://gitlab.eduxiji.net/qtliu/la-seL4_tools/-/tree/dev) | [la-seL4_tools-dev](https://github.com/tyyteam/la-seL4_tools/tree/dev) |
|  la-musllibc   |          æä¾›ä»£ç é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥çš„è½»é‡çº§Cè¯­è¨€åº“           | [la-musllibc-dev](https://gitlab.eduxiji.net/qtliu/la-musllibc/-/tree/dev) | [la-musllibc-dev](https://github.com/tyyteam/la-musllibc/tree/dev) |
| la-sel4runtime |              è¿è¡ŒCè¯­è¨€å…¼å®¹ç¨‹åºçš„æœ€å°runtimeç³»ç»Ÿ              | [la-sel4runtime-dev](https://gitlab.eduxiji.net/qtliu/la-sel4runtime/-/tree/dev) | [la-sel4runtime-dev](https://github.com/tyyteam/la-sel4runtime/tree/dev) |
|  la-seL4_libs  |              åœ¨seL4å¾®å†…æ ¸ä¸Šç¼–å†™ç”¨æˆ·ç¨‹åºçš„ç¨‹åºåº“              | [la-seL4_libs-dev](https://gitlab.eduxiji.net/qtliu/la-seL4_libs/-/tree/dev) | [la-seL4_libs-dev](https://github.com/tyyteam/la-seL4_libs/tree/dev) |
|  la-util_libs  | seL4å¾®å†…æ ¸ä½¿ç”¨çš„ç¨‹åºåº“ï¼ŒåŒ…æ‹¬pcié©±åŠ¨åº“ã€é©±åŠ¨ç¨‹åºåº“ã€è®¾å¤‡æ ‘åº“ç­‰ | [la-util_libs-dev](https://gitlab.eduxiji.net/qtliu/la-util_libs/-/tree/dev) | [la-util_libs-dev](https://github.com/tyyteam/la-util_libs/tree/dev) |



# å‚è€ƒèµ„æ–™

* è®¾è®¡æ€æƒ³ï¼š

  * [seL4å®˜æ–¹èµ„æ–™](https://docs.sel4.systems/)(åŒ…æ‹¬è®¾è®¡æ€æƒ³ã€APIï¼ŒseL4ç¯å¢ƒé…ç½®ï¼Œé¡¹ç›®æ„å»ºå’Œç¼–è¯‘æ–¹æ³•)

  * [é¾™èŠ¯å¼€æºæ–‡æ¡£](https://github.com/loongson)

  * [å¼ è€å¸ˆæä¾›çš„é¾™èŠ¯èµ„æ–™](https://github.com/foxsen/qemu-loongarch-runenv)

  * [å¾ªåºæ¸è¿›ï¼Œå­¦ä¹ å¼€å‘ä¸€ä¸ªRISC-Vä¸Šçš„æ“ä½œç³»ç»Ÿ - æ±ªè¾°](https://www.bilibili.com/video/BV1Q5411w7z5?spm_id_from=333.999.0.0)

* æŠ€æœ¯æ–‡æ¡£ï¼š

  * [qemuæ–‡æ¡£](https://www.qemu.org/)

  * [gccæ–‡æ¡£](https://gcc.gnu.org/)

* å‚è€ƒä½œå“ï¼š
  * [2021å¹´æ“ä½œç³»ç»Ÿå¤§èµ›å‚èµ›é˜Ÿçš„å¼€æºä½œå“](https://os.educg.net/2021CSCC)



# è‡´è°¢

æ„Ÿè°¢å›¢é˜Ÿæˆå‘˜ï¼ˆåˆ˜åº†æ¶›ï¼Œé›·æ´‹å’Œé™ˆæ´‹ï¼‰å½¼æ­¤ç»™äºˆçš„æ”¯æŒé¼“åŠ±ğŸ˜ŠğŸ˜ŠğŸ˜Š

**æ›´åŠ æ„Ÿè°¢**æŒ‡å¯¼è€å¸ˆï¼ˆå¼ ç¦æ–°è€å¸ˆå’Œé«˜ç‡•èè€å¸ˆï¼‰çš„è¾›å‹¤ä»˜å‡ºğŸ‘ğŸ‘ğŸ‘

è¿˜è¦æ„Ÿè°¢èƒ¡èµ·ï¼Œè¢å®‡ç¿€ï¼Œè°¢æœ¬å£¹ï¼Œæ¢æ€è¿œçš„å¸®åŠ©å’Œå»ºè®®ï¼Œæ„Ÿè°¢seL4æŠ€æœ¯å›¢é˜Ÿï¼ˆKent McLeodï¼ŒAxel Heiderï¼ŒJashank Jeremyï¼ŒGernot Heiserï¼ŒGerwin Kleinç­‰ï¼‰åœ¨github issueä¸Šçš„æŒ‡å¯¼å’Œæ”¯æŒâ¤ï¸â¤ï¸â¤ï¸











# ç›®æ ‡æè¿°

æœ¬é¡¹ç›®å°†seL4å¾®å†…æ ¸ç§»æ¤åˆ°LoongArchå¹³å°ä¸Šã€‚

* æ­å»ºäº¤å‰ç¼–è¯‘ç¯å¢ƒï¼Œåœ¨QEMUæ¨¡æ‹Ÿå™¨ä¸Šè°ƒè¯•å¾®å†…æ ¸ã€‚
* ç§»æ¤ç›¸å…³æµ‹è¯•ç¨‹åºã€‚
* æœ€ç»ˆå®ç°é¾™èŠ¯æœºå™¨ä¸Šçš„å¾®å†…æ ¸è°ƒè¯•ã€‚

# èµ„æ–™è°ƒç ”

[seL4å¾®å†…æ ¸](https://sel4.systems/)ï¼Œæ˜¯[L4å¾®æ ¸å®¶æ—](https://en.wikipedia.org/wiki/L4_microkernel_family)çš„ç»å…¸å®ç°ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯é¦–ä¸ªé€šè¿‡å®Œæ•´å½¢å¼åŒ–éªŒè¯çš„å¾®æ ¸ã€‚å®ƒå…·æœ‰å®‰å…¨å¯é ã€é«˜æ€§èƒ½ç­‰ç‰¹ç‚¹ï¼Œé€šå¸¸ç”¨ä½œå®‰å…¨ç³»ç»Ÿçš„åº•å±‚æ¨¡å—ã€‚

ç›¸æ¯”äºxv6ç­‰æ•™å­¦æ“ä½œç³»ç»Ÿæˆ–åº”ç”¨å¹¿æ³›çš„linuxç³»ç»Ÿï¼ŒseL4å¾®æ ¸çš„åº•å±‚æ¶æ„æ–‡æ¡£è¾ƒå°‘ã€‚é’ˆå¯¹æœ¬èµ›é¢˜ï¼Œå›¢é˜Ÿè°ƒç ”èµ„æ–™å¦‚ä¸‹ï¼š

* [seL4çš„è®¾è®¡æ€æƒ³](https://docs.sel4.systems/projects/sel4/documentation.html)ã€‚

* [seL4çš„ç”¨æˆ·ç¨‹åºAPI](https://docs.sel4.systems/projects/sel4/api-doc.html)ã€‚

* [seL4åœ¨armï¼Œriscvå’Œx86æ¶æ„ä¸Šçš„ç¼–è¯‘å’Œè¿è¡Œ](https://docs.sel4.systems/GettingStarted#running-sel4)ã€‚

* seL4æºç ç»“æ„ï¼šç»“åˆåšå®¢èµ„æ–™**é˜…è¯»æºç **ã€‚

* seL4æ„å»ºå’Œç¼–è¯‘å·¥å…·ï¼š[CMake](https://cmake.org/)ï¼Œ[Ninja](https://ninja-build.org/)ã€‚

* [é¾™èŠ¯äº¤å‰ç¼–è¯‘å·¥å…·é“¾å’Œå¼€å‘æ–‡æ¡£](https://github.com/foxsen/qemu-loongarch-runenv)ã€‚

# ç³»ç»Ÿæ¡†æ¶è®¾è®¡--å¾…å®Œå–„


* è™šæ‹Ÿåœ°å€è®¾è®¡
![è™šæ‹Ÿåœ°å€ç©ºé—´è®¾è®¡](https://raw.githubusercontent.com/GooTal/picBed/master/myPics/è™šæ‹Ÿåœ°å€ç©ºé—´è®¾è®¡.png)
å›¾ï¼šè™šæ‹Ÿåœ°å€ç©ºé—´è®¾è®¡

ç‰©ç†åœ°å€ç©ºé—´ï¼š
1. å†…å­˜ç©ºé—´åˆ†ä¸ºä½åœ°å€æ®µå’Œé«˜åœ°å€æ®µï¼Œå½“å‰æˆ‘ä»¬åœ¨qemuæ¨¡æ‹Ÿä½¿ç”¨4GBå†…å­˜ï¼Œå¯¹åº”çš„åœ°å€æ®µåˆ†åˆ«ä¸º0x00000000-0x0FFFFFFFï¼ˆä½256MBï¼‰ï¼Œ0x90000000-0x17FFFFFFFï¼ˆå‰©ä½™4GB-256MBï¼‰ï¼Œå†…æ ¸çš„è£…è½½åœ°å€ä¸º0x900000000
2. IOåœ°å€æ®µåŸºåœ°å€ä½0x1FE00000

è™šæ‹Ÿåœ°å€ç©ºé—´ï¼š
1. ä½128TBä¸ºç”¨æˆ·ç©ºé—´ï¼Œé‡‡ç”¨é¡µè¡¨æ˜ å°„
2. å†…æ ¸ç©ºé—´é‡‡ç”¨ç›´æ¥æ˜ å°„çª—å£ï¼Œ0x9000_0000_0000_0000-0x9000_FFFF_FFFF_FFFFé…ç½®ä¸ºç›´æ¥æ˜ å°„è£…çª—å£ï¼ŒæŠ¹å»é«˜ä½çš„9åå’Œç‰©ç†åœ°å€ç©ºé—´ä¸€ä¸€å¯¹åº”ï¼Œå› æ­¤KERNEL_ELF_BASEä¸º0x9000_0000_9000_0000ï¼ŒKDEV_BASEä¸º0x9000_0000_1FE0_0000ï¼ŒæŠ¹å»é«˜ä½çš„9åå°±å¾—åˆ°Kernelå’ŒIOåŸºå€çš„å®é™…ç‰©ç†åœ°å€
3. å…¶ä½™æœªä½¿ç”¨çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸ºéæ³•åœ°å€ï¼Œå…¶ä¸­é¡¶éƒ¨çš„è¿™å—éæ³•ç©ºé—´å¯ä»¥ç”¨æ¥æ•è·å‡ºé”™çš„è´Ÿæ•°åœ°å€

* ä¾‹å¤–ä¸ä¸­æ–­


ç°æœ‰ä»£ç æ˜¯å‚è€ƒé¾™èŠ¯æ¶æ„linuxçš„ä¾‹å¤–å’Œä¸­æ–­ï¼Œä½†æ˜¯ç»“æ„æ¯”è¾ƒå¤æ‚ã€‚æ¥ä¸‹æ¥æ‰“ç®—å‚è€ƒxv6-riscvç­‰æ“ä½œç³»ç»Ÿï¼Œå®ç°åŸºç¡€çš„ä¾‹å¤–å’Œä¸­æ–­å¤„ç†ã€‚

* cmakeåˆ†æ
![cmake1](https://raw.githubusercontent.com/GooTal/picBed/master/myPics/cmake1.png)
å›¾ï¼šcmakeåˆ†æ(1)
cmakeåˆ†æ(1)å›¾æ˜¯å¯åŠ¨sel4testï¼ˆå¾®å†…æ ¸æµ‹è¯•æ¡†æ¶-ä»¥riscv-spikeä¸ºä¾‹ï¼‰é¡¹ç›®æ„å»ºçš„cmakeæ‰§è¡Œé€»è¾‘ï¼Œå…¶ä¸­æ ‡æ³¨çš„æ˜¯å„è„šæœ¬å’Œcmakeçš„ä¸€äº›ä¸»è¦è¡Œä¸ºï¼ŒååŠéƒ¨åˆ†æ˜¯sel4å¾®å†…æ ¸æµ‹è¯•æ¡†æ¶ä¾èµ–çš„sel4å®˜æ–¹å¼€æºçš„åº“çš„cmakeè®¾ç½®ï¼Œå› å’Œå†…æ ¸å…³è”ä¸å¤§ï¼Œè¿™é‡Œæ²¡æœ‰è®°å½•ã€‚

![cmake2](https://raw.githubusercontent.com/GooTal/picBed/master/myPics/cmake2.png)
å›¾ï¼šcmakeåˆ†æ(2)
cmakeåˆ†æ(2)å›¾æ˜¯sel4å†…æ ¸éƒ¨åˆ†çš„cmakeæ‰§è¡Œé€»è¾‘ï¼Œå…¶ä¸­å¾ˆå¤šé…ç½®ä¼šé€šè¿‡è„šæœ¬å’Œcmakeå®æˆ–è€…å‡½æ•°ç”Ÿæˆå¤´æ–‡ä»¶ï¼Œä¾›æ ¹æ®å…·ä½“æ¶æ„å’Œå¹³å°æ„å»ºçš„çš„å¾®å†…æ ¸ä½¿ç”¨ã€‚cmakeè¿‡ç¨‹ä¸­çš„å…·ä½“é€»è¾‘è¯·æŸ¥é˜…å›¾ç‰‡ä¸­å„èŠ‚ç‚¹çš„å™è¿°ã€‚

* ä»£ç ç›®å½•ç»“æ„å›¾
![seL4æºç ç›®å½•ç»“æ„å›¾](https://raw.githubusercontent.com/GooTal/picBed/master/myPics/seL4æºç ç›®å½•ç»“æ„å›¾.png)
å›¾ï¼šseL4æºç ç›®å½•ç»“æ„å›¾

å„ä»“åº“æºç è§æ–‡æ¡£[seL4ä»“åº“åŠé•œåƒè¯´æ˜](#seL4ä»“åº“åŠé•œåƒè¯´æ˜)ã€‚

* riscv-loongarchå¯„å­˜å™¨å’Œé‡ç‚¹æ±‡ç¼–æŒ‡ä»¤å¯¹ç…§è¡¨

è¡¨ï¼šriscv-loongarchå¯„å­˜å™¨æ˜ å°„æ–¹å¼

| RISCV | LA   | RISCV | LA                  |
| ----- | ---- | ----- | ------------------- |
| s1    | s0   | t4    | t4                  |
| s2    | s1   | t5    | t5                  |
| s3    | s2   | t6    | t6                  |
| s4    | s3   | t7    | t7                  |
| s5    | s4   | ra    | ra                  |
| s6    | s5   | sp    | sp                  |
| s7    | s6   | gp    | r21(ä¿ç•™ï¼Œä¸å¯åˆ†é…) |
| s8    | s7   | tp    | tp                  |
| s9    | s8   | a0    | a0                  |
| s0    | s9   | a1    | a1                  |
| s10   | t7   | a2    | a2                  |
| s11   | t8   | a3    | a3                  |
| t0    | t0   | a4    | a4                  |
| t1    | t1   | a5    | a5                  |
| t2    | t2   | a6    | a6                  |
| t3    | t3   | a7    | a7                  |

è¡¨ï¼šriscv-loongarché‡ç‚¹æ±‡ç¼–æŒ‡ä»¤å¯¹ç…§è¡¨


| RISCVæŒ‡ä»¤                      | LAæŒ‡ä»¤                                                       | riscvæŒ‡ä»¤è§£é‡Š                                                | LAæŒ‡ä»¤è§£é‡Š                                                   |
| ------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ecall                          | syscall 0                                                    | ä»Såˆ‡æ¢åˆ°M                                                   | 0æ˜¯ä¿ç•™é”™è¯¯ç                                                 |
| mv rd, rs                      | move rd, rs                                                  | x[rs]->x[rd]                                                 | x[rs]->x[rd]                                                 |
| wfi                            | idle level                                                   | å½“å‰ç¡¬ä»¶çº¿ç¨‹å¯ä»¥è¢«æš‚åœç›´åˆ°éœ€è¦å¤„ç†ä¸€ä¸ªä¸­æ–­                   | å¤„ç†å™¨æ ¸åœæ­¢å–æŒ‡ä»¤ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´è‡³è¢«ä¸­æ–­å”¤é†’æˆ–è¢«å¤ä½ï¼Œç„¶åæ‰§è¡ŒidleæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ |
| STORE_S rd, offset(rs)         | st.d rd, rs, offset                                          | x[rd] -> M[ x[rs]+offset ]                                   | x[rd] -> M[ x[rs]+offset ]                                   |
| LOAD_S rd, offset(rs)          | ld.d rd, rs, offset                                          | LOAD_Så®å±•å¼€åæ˜¯LOADå­—ç¬¦ä¸²ï¼ŒM[x[rs] +offset] -> x[rd]  ,Mè¡¨ç¤ºå†…å­˜ | M[ x[rs]+offset ] -> x[rd]                                   |
| j offset                       | b offset                                                     | è·³è½¬åˆ°pc+offset                                              | åŒå·¦                                                         |
| jalr x1, 0(rs1) ç”¨æ³•ï¼šjalr rs1 | jirl rd, rj, offs16 ç­‰æ•ˆç”¨æ³•ï¼šjirl ra, rj, 0 æ­¤å¤„raç‰¹æŒ‡è¿”å›åœ°å€å¯„å­˜å™¨ï¼Œrjç­‰æ•ˆäºå·¦ä¾§rs1 | pc+4å­˜å…¥x[1](raä¸­)ï¼Œè·³è½¬åˆ°rs1å¤„ã€‚                            | pc+4å­˜å…¥rdä¸­ï¼Œè·³è½¬åœ°å€ï¼šrjçš„å€¼+offs16é€»è¾‘å·¦ç§»ä¸¤ä½å†ç¬¦å·æ‰©å±•ã€‚ |
| li rd, imm                     | li.w/li.d rd, imm                                            | loadç«‹å³æ•°                                                   | åŒå·¦                                                         |
| bne rs1, rs2, offset           | åŒå·¦                                                         | ä¸ç›¸ç­‰æ—¶åˆ†æ”¯ï¼ˆx[rs1] != x[rs2]ï¼‰                             | åŒå·¦                                                         |
| rdtime rd                      | rdtime.d rd, rj                                              | è¯»å‡ºæ—¶é—´ç›¸å…³å¯„å­˜å™¨åˆ°rd                                       | è¯»å‡ºæ—¶é—´ç›¸å…³å¯„å­˜å™¨åˆ°rdï¼Œéœ€è¦è¿”å›ï¼›rjä¿å­˜counter IDå·ï¼Œå¯ä»¥ä¸è¿”å›ï¼Œ |
| rdcycle rd                     | æš‚æ—¶ç”¨rdtimeæ›¿ä»£                                             |                                                              |                                                              |
| sfence.vma x0, rj              | invtlb 0x4,rj,r0                                             | vaddr=x0, asid=rjå³ä¸ä¸º0æ—¶ï¼Œä½œç”¨äºæŒ‡å®šasidçš„å„çº§é¡µè¡¨è®¿é—®æ“ä½œï¼Œä¸åŒ…æ‹¬å…¨å±€æ˜ å°„ | è§å‚è€ƒèµ„æ–™-é¾™èŠ¯æŒ‡ä»¤é›†å·1-4.2.4.7ï¼Œè¯¥æŒ‡ä»¤ä¸åœ¨æ­¤å±•å¼€ã€‚r0æ˜¯ç‰¹æŒ‡ï¼Œrjæ˜¯æ³›æŒ‡æŸå¯„å­˜å™¨ã€‚0x4è¡¨ç¤ºG=0ï¼ŒæŒ‡å®šasid=rjçš„é¡µè¡¨é¡¹ |
| sfence.vma                     | invtlb 0x0,r0,r0                                             | ä½œç”¨äºæ‰€æœ‰åœ°å€ç©ºé—´çš„å„çº§é¡µè¡¨è®¿é—®æ“ä½œ                         | è§å‚è€ƒèµ„æ–™-é¾™èŠ¯æŒ‡ä»¤é›†å·1-4.2.4.7ï¼Œè¯¥æŒ‡ä»¤ä¸åœ¨æ­¤å±•å¼€ã€‚r0æ˜¯ç‰¹æŒ‡r0å¯„å­˜å™¨ã€‚0x0è¡¨ç¤ºæ¸…é™¤æ‰€æœ‰é¡µè¡¨é¡¹ |
| fence.i                        | ibar 0                                                       | åœ¨ Fence.I ä¹‹åæ‰€æœ‰æŒ‡ä»¤çš„å–æŒ‡ä»¤æ“ä½œï¼Œä¸€å®šèƒ½å¤Ÿè§‚æµ‹åˆ°åœ¨ Fence.I ä¹‹å‰æ‰€æœ‰æŒ‡ä»¤é€ æˆçš„è®¿å­˜ç»“æœ | ç”¨äºå•æ ¸å†…éƒ¨storeæ“ä½œä¸å–æŒ‡æ“ä½œä¹‹é—´çš„åŒæ­¥ã€‚ç¡®ä¿è¯¥æŒ‡ä»¤ä¹‹åçš„å–å€¼ä¸€å®šèƒ½å¤Ÿè§‚å¯Ÿåˆ°è¯¥æŒ‡ä»¤ä¹‹å‰æ‰€æœ‰storeæ“ä½œçš„æ‰§è¡Œæ•ˆæœã€‚Load Barrier è¯»å±éšœã€‚åœ¨è¯»æŒ‡ä»¤å‰æ’å…¥è¯¥æŒ‡ä»¤ï¼Œå¯ä»¥è®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œé‡æ–°ä»ä¸»å†…å­˜åŠ è½½æ•°æ® |
| jal offset                     | bl offset                                                    | pc+4å­˜å…¥raï¼Œpc=pc+offset                                     | åŒå·¦                                                         |
| bnez rj, offset                | bnez rj, offset                                              | ä¸ç­‰äº0è·³è½¬                                                  | åŒå·¦                                                         |
| bnqz rj, offset                | bnqz rj, offset                                              | ç­‰äº0è·³è½¬                                                    | åŒå·¦                                                         |
| beq rj, rd, offset             | beq rj, rd, offset                                           | ç›¸ç­‰æ—¶è·³è½¬                                                   | åŒå·¦                                                         |
| beqz rj, offset                | beqz rj, offset                                              | rj==0ï¼Œè·³è½¬åˆ°offset                                          | åŒå·¦                                                         |
| jr rj                          | jirl zero, rj, 0                                             | å¯„å­˜å™¨è·³è½¬ pc=x[]                                            | åŒå·¦                                                         |
| la                             | la                                                           | åŠ è½½ç¬¦å·åœ°å€                                                 | åŒå·¦                                                         |

# seL4ä»“åº“åŠé•œåƒè¯´æ˜

åœ¨[seL4å¾®å†…æ ¸å®˜æ–¹ä»“åº“](https://github.com/seL4)é‡Œï¼ŒåŒ…å«[å¾®å†…æ ¸ä»“åº“](https://github.com/seL4/seL4)ã€[sel4testæµ‹è¯•ä»“åº“](https://github.com/seL4/sel4test)ç­‰ä¸ªä»“åº“ã€‚ä¸ºå®ç°seL4ç§»æ¤å’ŒåŸºç¡€æµ‹è¯•ï¼Œæˆ‘ä»¬forkäº†å…¶ä¸­7ä¸ªå®˜æ–¹ä»“åº“ï¼Œå¹¶åœ¨gitlabå»ºç«‹é•œåƒï¼Œè¿™7ä¸ªä»“åº“çš„åŠŸèƒ½å’Œé“¾æ¥å¦‚ä¸‹ã€‚

|     ä»“åº“å     |                           ä»“åº“æè¿°                           |                          gitlabåœ°å€(dev)                          |                          githubåœ°å€(dev)                          |
| :------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|    la-seL4     |                        seL4å¾®å†…æ ¸ä»£ç                         | [å½“å‰ä»“åº“](https://gitlab.eduxiji.net/qtliu/project788067-109730) |  [la-seL4-dev](https://github.com/tyyteam/la-seL4/tree/dev)  |
|  la-sel4test   |                 seL4æµ‹è¯•ä»£ç ï¼ˆç”¨æˆ·ç©ºé—´ç¨‹åºï¼‰                 | [la-sel4test-dev](https://gitlab.eduxiji.net/qtliu/la-sel4test/-/tree/dev) | [la-sel4test-dev](https://github.com/tyyteam/la-sel4test/tree/dev) |
| la-seL4_tools  |          æ„å»ºseL4é¡¹ç›®çš„å·¥å…·ï¼ŒåŒ…å«cmakeï¼Œelfloaderç­‰          | [la-seL4_tools-dev](https://gitlab.eduxiji.net/qtliu/la-seL4_tools/-/tree/dev) | [la-seL4_tools-dev](https://github.com/tyyteam/la-seL4_tools/tree/dev) |
|  la-musllibc   |          æä¾›ä»£ç é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥çš„è½»é‡çº§Cè¯­è¨€åº“           | [la-musllibc-dev](https://gitlab.eduxiji.net/qtliu/la-musllibc/-/tree/dev) | [la-musllibc-dev](https://github.com/tyyteam/la-musllibc/tree/dev) |
| la-sel4runtime |              è¿è¡ŒCè¯­è¨€å…¼å®¹ç¨‹åºçš„æœ€å°runtimeç³»ç»Ÿ              | [la-sel4runtime-dev](https://gitlab.eduxiji.net/qtliu/la-sel4runtime/-/tree/dev) | [la-sel4runtime-dev](https://github.com/tyyteam/la-sel4runtime/tree/dev) |
|  la-seL4_libs  |              åœ¨seL4å¾®å†…æ ¸ä¸Šç¼–å†™ç”¨æˆ·ç¨‹åºçš„ç¨‹åºåº“              | [la-seL4_libs-dev](https://gitlab.eduxiji.net/qtliu/la-seL4_libs/-/tree/dev) | [la-seL4_libs-dev](https://github.com/tyyteam/la-seL4_libs/tree/dev) |
|  la-util_libs  | seL4å¾®å†…æ ¸ä½¿ç”¨çš„ç¨‹åºåº“ï¼ŒåŒ…æ‹¬pcié©±åŠ¨åº“ã€é©±åŠ¨ç¨‹åºåº“ã€è®¾å¤‡æ ‘åº“ç­‰ | [la-util_libs-dev](https://gitlab.eduxiji.net/qtliu/la-util_libs/-/tree/dev) | [la-util_libs-dev](https://github.com/tyyteam/la-util_libs/tree/dev) |

# å¼€å‘è¿›åº¦å’Œè®¡åˆ’

- [x] 2022.02.25 - 2022.02.28 
  è°ƒç ”å­¦ä¹ é˜¶æ®µï¼Œè™šæ‹Ÿæœºç¯å¢ƒé…ç½®ã€è½¯ä»¶å®‰è£…ä¸sel4çš„å°è¯•è¿è¡Œã€‚
- [x] 2022.03.01 - 2022.03.03
  è°ƒç ”å­¦ä¹ é˜¶æ®µï¼Œå°è¯•äº¤å‰ç¼–è¯‘ä¸åŒæ¶æ„ä¸‹çš„sel4å¾®å†…æ ¸å¹¶è¯•è¿è¡Œï¼Œè°ƒç ”å®˜æ–¹æ–‡æ¡£ï¼Œå»ºç«‹å¼€å‘ä»“åº“ã€‚
- [x] 2022.03.04 - 2022.03.07
  è°ƒç ”å­¦ä¹ é˜¶æ®µï¼Œç»§ç»­è°ƒç ”ï¼Œç¡®å®šäº†è¦å°†sel4test(sel4å¾®å†…æ ¸æµ‹è¯•æ¡†æ¶)é¡¹ç›®ç§»æ¤åˆ°é¾™èŠ¯å¹³å°ã€‚
- [x] 2022.03.09 - 2022.03.11
  è°ƒç ”å­¦ä¹ é˜¶æ®µï¼Œå­¦ä¹ sel4å®˜æ–¹ç½‘ç«™çš„èµ„æ–™ï¼Œç†Ÿæ‚‰sel4è®¾è®¡æ¨¡å¼å’Œç‰¹ç‚¹ã€‚
- [x] 2022.03.12 - 2022.03.22
  å‡†å¤‡é˜¶æ®µï¼Œï¼Œå®Œæˆé¾™èŠ¯äº¤å‰ç¼–è¯‘è°ƒè¯•ç¯å¢ƒçš„é…ç½®ï¼Œå®Œæˆsel4å®˜æ–¹ç½‘ç«™ç»™å‡ºçš„ç¤ºä¾‹æ•™ç¨‹ï¼Œé˜…è¯»å®˜æ–¹æ–‡æ¡£ã€‚
- [x] 2022.03.23 - 2022.03.26
  å‡†å¤‡é˜¶æ®µï¼Œ**æ˜ç¡®äº†å‚è€ƒsel4åœ¨RISCVæ¶æ„ä¸‹çš„è®¾è®¡ï¼Œå°†å…¶ç§»æ¤åˆ°é¾™èŠ¯å¹³å°çš„å¼€å‘æ¨¡å¼**ï¼Œæœé›†è°ƒç ”RISCVå’Œé¾™èŠ¯å¼€å‘æ–‡æ¡£ï¼Œå¹¶å°è¯•å¼€å§‹å¯åŠ¨è°ƒè¯•ã€‚å»ºç«‹äº†å„æ€ç»´å¯¼å›¾(è™šæ‹Ÿåœ°å€è®¾è®¡å›¾ã€sel4æºç ç›®å½•ç»“æ„å›¾ã€sel4å¯åŠ¨æµç¨‹å›¾ç­‰)ã€é¾™èŠ¯linuxå’Œsel4çš„æºç æ³¨é‡Šä»“åº“ç­‰ï¼Œå¼€å§‹ä»é˜…è¯»æºç å…¥æ‰‹ç§»æ¤ã€‚
- [x] 2022.03.27 - 2022.03.29
  å‡†å¤‡é˜¶æ®µï¼Œå¼€ä¼šæ˜ç¡®åˆ†å·¥ï¼Œåˆ˜ã€é™ˆä¸»è¦è´Ÿè´£sel4é¾™èŠ¯æ¶æ„ç›¸å…³æŠ€æœ¯ç»†èŠ‚è®¾è®¡ï¼Œå¹¶ä»sel4å†…æ ¸å¯åŠ¨å¼€å§‹ç§»æ¤ï¼Œé›·ä¸»è¦è´Ÿè´£ä»cmakeé¡¹ç›®æ„å»ºå’Œç¼–è¯‘å¼€å§‹ç§»æ¤ã€‚
- [x] 2022.03.30 - 2022.04.12
  ç§»æ¤é˜¶æ®µï¼Œè¡¥å……é¾™èŠ¯æ¶æ„ç¼ºå°‘çš„æ–‡ä»¶ï¼Œ**å®Œæˆäº†ä»è¿è¡Œè„šæœ¬åˆ°æ¶æ„ç›¸å…³çš„é¡¹ç›®çš„æ„å»ºæµç¨‹**ã€‚
- [x] 2022.04.13 - 2022.05.03
  ç§»æ¤é˜¶æ®µï¼ŒåŸºæœ¬å®Œæˆäº†é¾™èŠ¯æ¶æ„ç›¸å…³æŠ€æœ¯ç»†èŠ‚çš„è®¾è®¡å’Œç§»æ¤ï¼Œå¹¶è°ƒè¯•**é€šè¿‡äº†ninjaç¼–è¯‘**ã€‚
- [x] 2022.05.04 - 2022.05.15
  è°ƒè¯•å’Œå®Œå–„é˜¶æ®µï¼Œè¿›è¡Œgdbè°ƒè¯•ï¼Œä¸”å·²ç»**æˆåŠŸè¿›å…¥å†…æ ¸**ã€‚è¿›è¡Œç›¸å…³æŠ€æœ¯æ–‡æ¡£çš„æ’°å†™ï¼Œè¿æ¥ä¸­æœŸæ£€æŸ¥ã€‚
- [ ] 2022.05.16 - 2022.05.31
  è°ƒè¯•å’Œå®Œå–„é˜¶æ®µï¼Œè¿›ä¸€æ­¥è°ƒè¯•å’Œå®Œå–„ï¼Œäº‰å–åœ¨äº”æœˆåº•å®Œæˆç§»æ¤å·¥ä½œï¼Œä½¿sel4testæˆåŠŸè¿è¡Œã€‚
- [ ] 2022.06 - ä»¥å
  å°è¯•å¢åŠ æ›´å¤šç»†èŠ‚ä»¥åŠ ä»¥å®Œå–„ï¼Œå¦‚ä¸­æ–­ï¼Œè¿è¡Œç¤ºä¾‹ç­‰ã€‚

æ›´åŠ è¯¦ç»†çš„å¼€å‘æ—¥å¿—è¯·è§[è…¾è®¯æ–‡æ¡£](https://docs.qq.com/sheet/DWWxDdmJvUU9sanl1?scene=6d554d98c90461c289f4f9a1s1iQn1&tab=rc2xgg)ï¼Œå¦‚æ²¡æœ‰æƒé™æŸ¥çœ‹è¯·è”ç³»å°ç»„æˆå‘˜ã€‚

# é‡è¦è¿›å±•

å¾…å®Œå–„

# é‡åˆ°çš„ä¸»è¦é—®é¢˜å’Œè§£å†³æ–¹æ³•

å›¢é˜Ÿä»è°ƒç ”å­¦ä¹ åˆ°è°ƒè¯•é˜¶æ®µçš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œå…¨éƒ¨è®°å½•åœ¨githubä»“åº“[oscompProblemSolutions](https://github.com/tyyteam/seL4-oscompProblemSolutions)ï¼Œè¯·åˆ‡æ¢åˆ†æ”¯æŸ¥çœ‹å„é˜Ÿå‘˜çš„è®°å½•ã€‚

# åˆ†å·¥å’Œåä½œ

åˆ˜åº†æ¶›ï¼šæ·»åŠ è®¾å¤‡æ ‘æ–‡ä»¶ã€uarté©±åŠ¨ï¼›ç¼–ç ä¸­æ–­æ¨¡å—ï¼›è®¾è®¡è™šæ‹Ÿåœ°å€ï¼›å‚ä¸é¡¹ç›®è°ƒç ”ã€æºç æ³¨é‡Šã€å†…æ ¸è°ƒè¯•å’Œæ–‡æ¡£æ’°å†™ã€‚

é›·æ´‹ï¼šåˆ†æé¡¹ç›®çš„cmakeæ„å»ºæµç¨‹å¹¶æ·»åŠ é¾™èŠ¯æ¶æ„æ”¯æŒï¼›ç¼–å†™è„šæœ¬ç®€åŒ–é¡¹ç›®æ„å»ºã€åˆå§‹åŒ–å’Œå¼€å‘æµç¨‹ï¼›å‚ä¸é¡¹ç›®è°ƒç ”ã€æºç æ³¨é‡Šã€å†…æ ¸è°ƒè¯•å’Œæ–‡æ¡£æ’°å†™ã€‚

é™ˆæ´‹ï¼šè®¾è®¡è™šæ‹Ÿåœ°å€ç©ºé—´ã€ç¼–ç å†…å­˜ç®¡ç†æ¨¡å—ï¼›è°ƒè¯•å†…æ ¸å¯åŠ¨æºç ï¼›ç§»æ¤elfloaderï¼›å‚ä¸é¡¹ç›®è°ƒç ”ã€æºç æ³¨é‡Šã€å†…æ ¸è°ƒè¯•å’Œæ–‡æ¡£æ’°å†™ã€‚

# å¯¼å¸ˆæ²Ÿé€šåŠæŒ‡å¯¼æƒ…å†µ

åœ¨2022å¹´3æœˆï¼Œå›¢é˜Ÿä¸é¡¹ç›®æŒ‡å¯¼æ•™å¸ˆï¼ˆå¼ ç¦æ–°è€å¸ˆï¼‰å¼€å§‹äº¤æµæ¯”èµ›ä¿¡æ¯ï¼Œé€‰æ‹©[proj97-la-seL4](https://github.com/oscomp/proj97-la-seL4)èµ›é¢˜ã€‚

å›¢é˜Ÿæˆå‘˜ç»å¸¸åœ¨è…¾è®¯ä¼šè®®å’Œå¾®ä¿¡ç¾¤ä¸­ä¸å¼ è€å¸ˆäº¤æµèµ›é¢˜å†…å®¹å’Œä»£ç ç»†èŠ‚ï¼Œå¹¶æ ¹æ®è€å¸ˆæä¾›çš„é¾™èŠ¯äº¤å‰ç¼–è¯‘å·¥å…·ã€é¾™èŠ¯å¼€å‘æ‰‹å†Œã€L4ç›¸å…³è®ºæ–‡ç­‰èµ„æ–™ï¼ˆå…·ä½“è§[å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)ï¼‰é€æ­¥ç§»æ¤seL4å¾®å†…æ ¸ã€‚

éå¸¸æ„Ÿè°¢å¼ è€å¸ˆä¸ºseL4ç§»æ¤å·¥ä½œç»™äºˆçš„æŒ‡å¯¼ã€‚

# é¡¹ç›®æ„å»ºå’Œç¼–è¯‘æ–¹æ³•

seL4å®˜æ–¹ç»™å‡ºçš„ä¾èµ–åŒ…ï¼š[Dependencies(seL4 docs)](https://docs.sel4.systems/projects/buildsystem/host-dependencies.html)ã€‚

åˆ›å»ºå¹¶è¿›å…¥`sel4test`ç›®å½•ï¼Œç”¨repoå‘½ä»¤è·å–å®˜æ–¹åº“ï¼š
```shell
mkdir sel4test
cd sel4test
repo init -u https://github.com/seL4/sel4test-manifest.git
repo sync
```

åœ¨```sel4test```ç›®å½•ä¸‹ï¼Œç”¨wgetè·å–å¹¶æ‰§è¡Œ```init_loongarch_seL4-test_dev.sh```ï¼š

```shell
wget home.ustc.edu.cn/~le24/shell/init_loongarch_seL4-test_dev.sh
chmod u+x init_loongarch_seL4-test_dev.sh
./init_loongarch-seL4-test_dev.sh ssh
```

åœ¨```sel4test```ç›®å½•ä¸‹ï¼Œåˆ›å»ºbuild_3A5000æ–‡ä»¶å¤¹ï¼š

```shell
mkdir build_3A5000
cd build_3A5000
../init-build.sh -DPLATFORM=3A5000 -DLoongarch64=1 -DSIMULATION=1
```

ç¼–è¯‘ï¼š

```shell
ninja
```

å¦‚æœéœ€è¦æ‹‰å–å’Œæ¨é€ä»£ç ï¼Œæˆ‘ä»¬åœ¨[è¿™é‡Œ](https://github.com/tyyteam/seL4-oscompProblemSolutions/blob/leiyang/04.11%20sel4-test%20dev%E4%BB%93%E5%BA%93%E8%AE%BE%E7%BD%AE.md)æä¾›è„šæœ¬å¸®åŠ©ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚
# ä¸­æœŸå¼€å‘çŠ¶æ€
[ç‚¹å‡»æ­¤å¤„](https://pan.baidu.com/s/1c8KKPdG0Ri_AbR2taWWPSw?pwd=2qdg)æŸ¥çœ‹æ¼”ç¤ºè§†é¢‘åŠæ–‡å­—è¯´æ˜


# å‚è€ƒèµ„æ–™

[seL4å®˜æ–¹èµ„æ–™](https://docs.sel4.systems/)(åŒ…æ‹¬è®¾è®¡æ€æƒ³ã€APIï¼ŒseL4ç¯å¢ƒé…ç½®ï¼Œé¡¹ç›®æ„å»ºå’Œç¼–è¯‘æ–¹æ³•)

[é¾™èŠ¯å¼€æºæ–‡æ¡£](https://github.com/loongson)

[å¼ è€å¸ˆæä¾›çš„é¾™èŠ¯èµ„æ–™](https://github.com/foxsen/qemu-loongarch-runenv)

[å¾ªåºæ¸è¿›ï¼Œå­¦ä¹ å¼€å‘ä¸€ä¸ªRISC-Vä¸Šçš„æ“ä½œç³»ç»Ÿ - æ±ªè¾°](https://www.bilibili.com/video/BV1Q5411w7z5?spm_id_from=333.999.0.0)

[qemuæ–‡æ¡£](https://www.qemu.org/)

[gccæ–‡æ¡£](https://gcc.gnu.org/)

[2021å¹´æ“ä½œç³»ç»Ÿå¤§èµ›å‚èµ›é˜Ÿçš„å¼€æºä½œå“](https://os.educg.net/2021CSCC)